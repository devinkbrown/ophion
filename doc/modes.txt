Ophion Mode Reference
=====================

Standard user modes are listed in help/opers/umode
Standard server notice masks are listed in help/opers/snomask
Standard channel modes are listed in help/opers/cmode

The oper-guide (doc/oper-guide/) has comprehensive documentation.

IRCX Channel Modes (m_ircx_modes module)
-----------------------------------------

  +a  AUTHONLY   - Only authenticated (services-identified) users may join
  +d  CLONEABLE  - Channel creates numbered clones when full
  +E  CLONE      - Marks channel as a clone of a +d channel (IRCX +e remapped)
  +f  NOFORMAT   - Raw text only, clients should not format
  +h  HIDDEN     - Not in LIST/LISTX but queryable by name
  +u  KNOCK      - Enables KNOCK notifications to channel hosts/owners
  +z  SERVICE    - Service monitoring channel, oper-only

IRCX Visibility Model (mutually exclusive)
  PUBLIC   - No mode flag (default). Visible in LIST, all data queryable.
  PRIVATE  - +p (RFC1459). Listed but properties restricted.
  HIDDEN   - +h (IRCX). Not in LIST but queryable if name is known.
  SECRET   - +s (RFC1459). Not visible to non-members at all.

Other IRCX Channel Modes (separate modules)
  +x  AUDITORIUM - Only ops visible to non-ops (m_ircx_auditorium)
  +w  NOWHISPER  - Disables WHISPER command in channel (m_ircx_whisper)

IRCX User Mode (m_ircx_oper module)
-------------------------------------

  +z  GAG        - User silenced globally, oper-only set/unset

IRCX Commands
--------------

  AUTH     - IRCX authentication (m_ircx_auth)
  CREATE   - Create channel with initial modes (m_ircx_create)
  LISTX    - Extended channel listing (m_ircx_listx)
  PROP     - Get/set/list properties on channels and users (m_ircx_prop)
  WHISPER  - Private message to channel member (m_ircx_whisper)
  ACCESS   - Channel access list management (m_ircx_access)
  EVENT    - Oper event subscription system (m_ircx_event)
  GAG      - Silence a user globally, oper-only (m_ircx_oper)
  OPFORCE  - Unified oper channel force commands (m_ircx_oper)

Microsoft Comic Chat Support (m_ircx_comic module)
----------------------------------------------------

  The m_ircx_comic module enables Microsoft Comic Chat/Microsoft Chat
  character metadata via the PROP system. Advertised via ISUPPORT COMICCHAT.

  PROP keys: MCC (character data), MCCGUID (character GUID), MCCEX (expression)

ACCESS Hierarchy Overrides
---------------------------

  When the m_ircx_access module is loaded, ACCESS list entries can
  override channel join restrictions based on hierarchy:

    OWNER/ADMIN (CHFL_ADMIN) - overrides: +b, +k, +i, +l, +j, +r
    HOST/OP (CHFL_CHANOP)    - overrides: +b, +k, +i, +l, +j
    VOICE (CHFL_VOICE)       - overrides: +b

  This allows channel access lists to serve as a complete authorization
  system.  Users with GRANT entries are already handled via +I (invex).

Oper God Mode and Auto-Promote (m_ircx_oper_godmode module)
-------------------------------------------------------------

  When loaded, this module provides the +G (god mode) umode and the
  oper_auto_op / oper_kick_protection general{} config flags.

  Opers receive automatic channel promotion on join according to their
  privset:

    oper:auto_op      - joins with +o (chanop); access ceiling CHFL_CHANOP
    oper:auto_admin   - joins with +q (admin); full CHFL_ADMIN access
    (neither)         - joins with +q by default when oper_auto_op = yes

  IRC server admins (oper:admin) always get +q with no ceiling.

  +W (whois notifications) is provided by extensions/sno_whois.so and
  fires only when a non-operator performs a WHOIS on the oper.

  See doc/oper-guide/oprivs.rst for full privilege documentation.

MEMBERKEY / +k Integration
----------------------------

  The IRCX MEMBERKEY property and IRC +k (channel key) mode are fully
  synchronized:

    PROP #channel MEMBERKEY mykey  ->  sets +k mykey
    PROP #channel MEMBERKEY :      ->  removes +k
    MODE #channel +k mykey         ->  MEMBERKEY reflects new key
    PROP #channel MEMBERKEY        ->  shows key to chanops only

MEMBERLIMIT / +l Integration
------------------------------

  The IRCX MEMBERLIMIT property and IRC +l (member limit) mode are fully
  synchronized (analogous to MEMBERKEY / +k):

    PROP #channel MEMBERLIMIT 50   ->  sets +l 50
    PROP #channel MEMBERLIMIT :    ->  removes +l
    MODE #channel +l 50            ->  MEMBERLIMIT reflects new limit
    PROP #channel MEMBERLIMIT      ->  shows limit to chanops only

Channel Content and Metadata Properties
-----------------------------------------

  PICS   (chanop read/write)
    Content-rating string for the channel (e.g. "GA", "PG", "R", "X").
    Stored as a custom property; no mode side-effect.

  LAG    (chanop read/write, value 0–2)
    Per-channel fake-lag in whole seconds.  After a successful channel
    message, the sending client's flood token bucket is charged by
    lag * client_flood_message_num tokens, giving real per-channel
    message throttling on top of the normal flood controls.

  CLIENT (chanop-only read/write)
    Arbitrary metadata string for use by client software.  Hidden from
    non-operators in PROP output; chanop-only read and write.

IRCX Pre-registration Probe
-----------------------------

  Per §3 of the IRCX draft, clients may probe for IRCX support before
  completing registration:

    MODE ISIRCX             ->  800 RPL_IRCX
    MODE <nick> ISIRCX      ->  800 RPL_IRCX

  Any other MODE usage before registration returns 451 ERR_NOTREGISTERED.

IRCX Channel-context Nick Targeting (PRIVMSG/NOTICE)
------------------------------------------------------

  Ophion supports IRCX-style targeted channel messages:

    PRIVMSG #channel nick1 nick2 :message text

  Each nick must be a member of #channel; non-members yield
  441 ERR_USERNOTINCHANNEL.  The message is delivered privately to each
  target with the channel name retained as context.

IRCX Module List
-----------------

  m_ircx_access           - ACCESS command, channel access lists, join overrides
  m_ircx_auditorium       - Auditorium mode (+x)
  m_ircx_auth             - AUTH command
  m_ircx_base             - IRCX base protocol negotiation
  m_ircx_comic            - Microsoft Comic Chat character metadata
  m_ircx_create           - CREATE command
  m_ircx_event            - EVENT command (CHANNEL/MEMBER/USER/SERVER/OPERSPY)
  m_ircx_listx            - LISTX command
  m_ircx_modes            - All IRCX channel modes (+u/+h/+a/+d/+E/+f/+r/+z)
  m_ircx_oper             - GAG mode (+z) and OPFORCE command
  m_ircx_oper_godmode     - God mode (+G), oper auto-promote, kick/ban protection
  m_ircx_prop             - PROP command core
  m_ircx_prop_ownerkey    - OWNERKEY channel property
  m_ircx_prop_channel_builtins - OID/NAME/CREATION/TOPIC/MEMBERCOUNT/MEMBERKEY/MEMBERLIMIT/PICS/LAG/CLIENT
  m_ircx_prop_entity_account   - Account entity properties
  m_ircx_prop_entity_channel   - Channel entity properties
  m_ircx_prop_entity_user      - User entity properties
  m_ircx_prop_member_of        - MEMBER_OF channel property
  m_ircx_prop_onjoin           - ONJOIN channel property
  m_ircx_prop_onpart           - ONPART channel property
  m_ircx_prop_opkey            - OPKEY/HOSTKEY channel property
  m_ircx_prop_user_profile     - User profile properties (URL, GENDER, etc.)
  m_ircx_whisper               - WHISPER command and +w mode

Standard Modes
--------------

User mode +x (hide hostname) is provided by extensions/ip_cloaking_unified.so
Server notice mask +F (far connects) is provided by extensions/sno_farconnect.so
Information on the caller ID system can be found in doc/features/modeg.txt
